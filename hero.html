<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Portfolio Hero</title>
    <style>
        /* CSS Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
            background: #000;
        }

        /* Hero Container - Full viewport with perspective */
        .hero-container {
            width: 100vw;
            height: 100vh;
            position: relative;
            perspective: 1200px;
            perspective-origin: center center;
            overflow: hidden;
        }

        /* Scene wrapper for 3D transforms */
        .parallax-scene {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            will-change: transform;
            transition: transform 0.1s ease-out;
        }

        /* Individual layer containers */
        .parallax-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            will-change: transform;
            transition: transform 0.1s ease-out;
        }

        .background-layer {
            z-index: 1;
        }

        .structures-layer {
            z-index: 2;
        }

        /* Image styling with object-fit: cover for fullscreen */
        .layer-image {
            width: 110%;
            height: 110%;
            object-fit: cover;
            object-position: center center;
            display: block;
            will-change: transform;
            transform: translate(-50%, -50%);
            position: absolute;
            top: 50%;
            left: 50%;
        }

        /* Hotspots container - inherits structures layer transform */
        .hotspots-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 3;
        }

        /* Individual hotspot styling */
        .hotspot {
            position: absolute;
            background: transparent;
            border: 2px solid transparent;
            cursor: pointer;
            pointer-events: auto;
            transition: all 0.3s ease;
            border-radius: 4px;
        }

        .hotspot:hover,
        .hotspot:focus {
            border-color: rgba(0, 150, 255, 0.8);
            background: rgba(0, 150, 255, 0.1);
            box-shadow: 0 0 20px rgba(0, 150, 255, 0.5);
            outline: none;
        }

        .hotspot::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 12px;
            height: 12px;
            background: rgba(0, 150, 255, 0.9);
            border: 2px solid white;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            animation: pulse 2s infinite;
        }

        .hotspot:hover::after {
            animation: none;
            background: rgba(0, 150, 255, 1);
            transform: translate(-50%, -50%) scale(1.2);
        }

        @keyframes pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            50% { transform: translate(-50%, -50%) scale(1.3); opacity: 0.7; }
        }

        /* Debug mode styles */
        .debug-mode .hotspot {
            border: 2px solid red;
            background: rgba(255, 0, 0, 0.2);
        }

        .debug-info {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            z-index: 1000;
            display: none;
        }

        .debug-mode .debug-info {
            display: block;
        }

        .debug-label {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            background: red;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: bold;
            display: none;
        }

        .debug-mode .debug-label {
            display: block;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: #1a1a1a;
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90vw;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid #333;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal-overlay.active .modal-content {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            color: white;
            font-size: 24px;
            font-weight: 600;
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            color: #999;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: color 0.3s ease;
        }

        .modal-close:hover {
            color: white;
            background: rgba(255, 255, 255, 0.1);
        }

        .modal-description {
            color: #ccc;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .modal-links {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .modal-link {
            display: inline-block;
            padding: 10px 20px;
            background: rgba(0, 150, 255, 0.8);
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-weight: 500;
            transition: background 0.3s ease;
        }

        .modal-link:hover {
            background: rgba(0, 150, 255, 1);
        }

        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            .parallax-scene,
            .parallax-layer,
            .layer-image {
                transition: none !important;
                will-change: auto !important;
            }
        }

        /* Mobile optimizations */
        @media (max-width: 768px) {
            .modal-content {
                padding: 20px;
                margin: 20px;
            }
            
            .modal-title {
                font-size: 20px;
            }
        }

        /* Accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Body scroll lock when modal is open */
        body.modal-open {
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div class="hero-container">
        <div class="parallax-scene" id="parallaxScene">
            <!-- Background Layer -->
            <div class="parallax-layer background-layer" data-speed="0.3">
                <img src="public/layers/background.png" alt="Background" class="layer-image" id="backgroundImage">
            </div>
            
            <!-- Structures Layer with Hotspots -->
            <div class="parallax-layer structures-layer" data-speed="1.0">
                <img src="public/layers/structures.png" alt="Structures" class="layer-image" id="structuresImage">
                
                <!-- Hotspots Overlay -->
                <div class="hotspots-overlay" id="hotspotsOverlay">
                    <!-- Hotspots will be dynamically inserted here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Debug Info Panel -->
    <div class="debug-info" id="debugInfo">
        <div>Container: <span id="debugContainer">0x0</span></div>
        <div>Image Rect: <span id="debugImageRect">0x0+0+0</span></div>
        <div>Position: <span id="debugPosition">0.00, 0.00</span></div>
        <div>Smooth: <span id="debugSmooth">0.00, 0.00</span></div>
        <div>Press 'D' to toggle debug mode</div>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Project Title</h2>
                <button class="modal-close" id="modalClose" aria-label="Close modal">&times;</button>
            </div>
            <div class="modal-description" id="modalDescription">
                Project description will appear here.
            </div>
            <div class="modal-links" id="modalLinks">
                <!-- Links will be dynamically inserted -->
            </div>
        </div>
    </div>

    <script>
        // Project data with normalized coordinates (0-1)
        const projectsData = [
            {
                id: "stadium",
                title: "Stadium Complex",
                description: "A modern sports stadium featuring advanced architecture and sustainable design. This project showcases our expertise in large-scale entertainment venues with crowd management and acoustics optimization.",
                links: [
                    { text: "Live Demo", url: "https://example.com/stadium" },
                    { text: "GitHub", url: "https://github.com/username/stadium" }
                ],
                region: { x: 0.25, y: 0.45, w: 0.35, h: 0.35 }
            },
            {
                id: "highway",
                title: "Smart Highway System",
                description: "An intelligent transportation network featuring automated traffic management, real-time monitoring, and sustainable energy solutions. Integration with IoT sensors and AI-powered optimization.",
                links: [
                    { text: "Case Study", url: "https://example.com/highway" },
                    { text: "Documentation", url: "https://docs.example.com/highway" }
                ],
                region: { x: 0.15, y: 0.15, w: 0.70, h: 0.25 }
            },
            {
                id: "solar-field",
                title: "Solar Energy Field",
                description: "Renewable energy installation with cutting-edge photovoltaic technology. Features smart grid integration, energy storage solutions, and environmental impact monitoring systems.",
                links: [
                    { text: "Project Details", url: "https://example.com/solar" },
                    { text: "Sustainability Report", url: "https://example.com/solar-report" }
                ],
                region: { x: 0.60, y: 0.55, w: 0.25, h: 0.25 }
            }
        ];

        class ParallaxHero {
            constructor() {
                this.scene = document.getElementById('parallaxScene');
                this.backgroundLayer = document.querySelector('.background-layer');
                this.structuresLayer = document.querySelector('.structures-layer');
                this.backgroundImage = document.getElementById('backgroundImage');
                this.structuresImage = document.getElementById('structuresImage');
                this.hotspotsOverlay = document.getElementById('hotspotsOverlay');
                
                // Parallax state
                this.pointer = { x: 0, y: 0 };
                this.smooth = { x: 0, y: 0 };
                this.isPointerActive = false;
                
                // Image dimensions for hotspot calculation
                this.imageRect = { width: 0, height: 0, offsetX: 0, offsetY: 0 };
                
                // Debug mode
                this.debugMode = false;
                
                // Reduced motion detection
                this.prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
                
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.createHotspots();
                this.startAnimation();
                this.updateImageRect();
                
                // Initial image load wait
                Promise.all([
                    this.waitForImageLoad(this.backgroundImage),
                    this.waitForImageLoad(this.structuresImage)
                ]).then(() => {
                    this.updateImageRect();
                    this.updateHotspots();
                });
            }

            waitForImageLoad(img) {
                return new Promise((resolve) => {
                    if (img.complete) {
                        resolve();
                    } else {
                        img.addEventListener('load', resolve);
                    }
                });
            }

            setupEventListeners() {
                // Pointer events (desktop)
                this.scene.addEventListener('pointermove', this.handlePointerMove.bind(this));
                this.scene.addEventListener('pointerleave', this.handlePointerLeave.bind(this));
                
                // Touch events (mobile)
                this.scene.addEventListener('touchstart', this.handleTouchStart.bind(this));
                this.scene.addEventListener('touchmove', this.handleTouchMove.bind(this));
                this.scene.addEventListener('touchend', this.handleTouchEnd.bind(this));
                
                // Resize handler
                window.addEventListener('resize', this.handleResize.bind(this));
                
                // Debug toggle
                document.addEventListener('keydown', this.handleKeyDown.bind(this));
                
                // Modal events
                this.setupModalEvents();
            }

            handlePointerMove(e) {
                if (this.prefersReducedMotion) return;
                
                const rect = this.scene.getBoundingClientRect();
                this.updatePointerPosition(e.clientX - rect.left, e.clientY - rect.top, rect.width, rect.height);
                this.isPointerActive = true;
            }

            handlePointerLeave() {
                this.isPointerActive = false;
                // Reset to center with easing
                this.pointer.x = 0;
                this.pointer.y = 0;
            }

            handleTouchStart(e) {
                e.preventDefault();
                if (e.touches.length === 1) {
                    const touch = e.touches[0];
                    const rect = this.scene.getBoundingClientRect();
                    this.updatePointerPosition(touch.clientX - rect.left, touch.clientY - rect.top, rect.width, rect.height);
                    this.isPointerActive = true;
                }
            }

            handleTouchMove(e) {
                e.preventDefault();
                if (this.prefersReducedMotion || e.touches.length !== 1) return;
                
                const touch = e.touches[0];
                const rect = this.scene.getBoundingClientRect();
                this.updatePointerPosition(touch.clientX - rect.left, touch.clientY - rect.top, rect.width, rect.height);
            }

            handleTouchEnd() {
                this.isPointerActive = false;
                this.pointer.x = 0;
                this.pointer.y = 0;
            }

            updatePointerPosition(x, y, width, height) {
                // Normalize to -1 to 1 range
                this.pointer.x = ((x / width) - 0.5) * 2;
                this.pointer.y = ((y / height) - 0.5) * 2;
            }

            handleResize() {
                this.updateImageRect();
                this.updateHotspots();
            }

            handleKeyDown(e) {
                if (e.key.toLowerCase() === 'd') {
                    this.toggleDebugMode();
                }
                if (e.key === 'Escape') {
                    this.closeModal();
                }
            }

            toggleDebugMode() {
                this.debugMode = !this.debugMode;
                document.body.classList.toggle('debug-mode', this.debugMode);
            }

            startAnimation() {
                const animate = () => {
                    this.updateSmoothing();
                    this.applyTransforms();
                    this.updateDebugInfo();
                    requestAnimationFrame(animate);
                };
                animate();
            }

            updateSmoothing() {
                // Smooth interpolation with lerp
                const lerpFactor = 0.08;
                this.smooth.x += (this.pointer.x - this.smooth.x) * lerpFactor;
                this.smooth.y += (this.pointer.y - this.smooth.y) * lerpFactor;
            }

            applyTransforms() {
                if (this.prefersReducedMotion) return;

                // Background layer - subtle movement (reduced for larger images)
                const bgMoveX = this.smooth.x * 4;
                const bgMoveY = this.smooth.y * 4;
                this.backgroundLayer.style.transform = `translate3d(${bgMoveX}px, ${bgMoveY}px, 0)`;

                // Structures layer - more movement (reduced for larger images)
                const structMoveX = this.smooth.x * 12;
                const structMoveY = this.smooth.y * 12;
                this.structuresLayer.style.transform = `translate3d(${structMoveX}px, ${structMoveY}px, 0)`;

                // Scene tilt - slightly reduced
                const tiltX = -this.smooth.y * 3;
                const tiltY = this.smooth.x * 3;
                this.scene.style.transform = `rotateX(${tiltX}deg) rotateY(${tiltY}deg)`;
            }

            updateImageRect() {
                const container = this.structuresImage.parentElement;
                const containerRect = container.getBoundingClientRect();
                const cw = containerRect.width;
                const ch = containerRect.height;
                
                // Get natural image dimensions
                const iw = this.structuresImage.naturalWidth || 1;
                const ih = this.structuresImage.naturalHeight || 1;
                
                // Calculate displayed size with object-fit: cover
                const scale = Math.max(cw / iw, ch / ih);
                const dw = iw * scale;
                const dh = ih * scale;
                const offsetX = (cw - dw) / 2;
                const offsetY = (ch - dh) / 2;
                
                this.imageRect = {
                    width: dw,
                    height: dh,
                    offsetX: offsetX,
                    offsetY: offsetY,
                    containerWidth: cw,
                    containerHeight: ch
                };
            }

            createHotspots() {
                projectsData.forEach(project => {
                    const hotspot = document.createElement('button');
                    hotspot.className = 'hotspot';
                    hotspot.setAttribute('data-project-id', project.id);
                    hotspot.setAttribute('aria-label', `Open ${project.title} project details`);
                    
                    // Add debug label
                    const label = document.createElement('div');
                    label.className = 'debug-label';
                    label.textContent = project.id;
                    hotspot.appendChild(label);
                    
                    // Click handler
                    hotspot.addEventListener('click', () => this.openModal(project));
                    
                    this.hotspotsOverlay.appendChild(hotspot);
                });
                
                this.updateHotspots();
            }

            updateHotspots() {
                const hotspots = this.hotspotsOverlay.querySelectorAll('.hotspot');
                
                hotspots.forEach((hotspot, index) => {
                    const project = projectsData[index];
                    if (!project) return;
                    
                    const { x, y, w, h } = project.region;
                    const { width, height, offsetX, offsetY } = this.imageRect;
                    
                    // Convert normalized coordinates to pixel positions
                    const left = offsetX + (x * width);
                    const top = offsetY + (y * height);
                    const hotspotWidth = w * width;
                    const hotspotHeight = h * height;
                    
                    hotspot.style.left = `${left}px`;
                    hotspot.style.top = `${top}px`;
                    hotspot.style.width = `${hotspotWidth}px`;
                    hotspot.style.height = `${hotspotHeight}px`;
                });
            }

            // Modal functionality
            setupModalEvents() {
                const modalOverlay = document.getElementById('modalOverlay');
                const modalClose = document.getElementById('modalClose');
                
                modalClose.addEventListener('click', () => this.closeModal());
                modalOverlay.addEventListener('click', (e) => {
                    if (e.target === modalOverlay) {
                        this.closeModal();
                    }
                });
            }

            openModal(project) {
                const modal = document.getElementById('modalOverlay');
                const title = document.getElementById('modalTitle');
                const description = document.getElementById('modalDescription');
                const links = document.getElementById('modalLinks');
                
                title.textContent = project.title;
                description.textContent = project.description;
                
                // Clear and populate links
                links.innerHTML = '';
                project.links.forEach(link => {
                    const linkEl = document.createElement('a');
                    linkEl.href = link.url;
                    linkEl.textContent = link.text;
                    linkEl.className = 'modal-link';
                    linkEl.target = '_blank';
                    linkEl.rel = 'noopener noreferrer';
                    links.appendChild(linkEl);
                });
                
                modal.classList.add('active');
                document.body.classList.add('modal-open');
                
                // Focus management
                const closeButton = document.getElementById('modalClose');
                setTimeout(() => closeButton.focus(), 100);
            }

            closeModal() {
                const modal = document.getElementById('modalOverlay');
                modal.classList.remove('active');
                document.body.classList.remove('modal-open');
            }

            updateDebugInfo() {
                if (!this.debugMode) return;
                
                const container = document.getElementById('debugContainer');
                const imageRect = document.getElementById('debugImageRect');
                const position = document.getElementById('debugPosition');
                const smooth = document.getElementById('debugSmooth');
                
                container.textContent = `${this.imageRect.containerWidth}x${this.imageRect.containerHeight}`;
                imageRect.textContent = `${Math.round(this.imageRect.width)}x${Math.round(this.imageRect.height)}+${Math.round(this.imageRect.offsetX)}+${Math.round(this.imageRect.offsetY)}`;
                position.textContent = `${this.pointer.x.toFixed(2)}, ${this.pointer.y.toFixed(2)}`;
                smooth.textContent = `${this.smooth.x.toFixed(2)}, ${this.smooth.y.toFixed(2)}`;
            }
        }

        // Initialize the parallax hero when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new ParallaxHero();
        });

        // Accessibility: Announce to screen readers
        const announcement = document.createElement('div');
        announcement.className = 'sr-only';
        announcement.setAttribute('aria-live', 'polite');
        announcement.textContent = 'Interactive portfolio hero loaded. Use tab to navigate to project hotspots.';
        document.body.appendChild(announcement);
    </script>
</body>
</html>